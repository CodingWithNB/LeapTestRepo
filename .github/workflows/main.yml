name: Test Leapwork Action

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Run Leapwork Automated Test flows, schedule Daily regression
        shell: pwsh
        run: |
          $headers = @{
            "AccessKey" = "ASvAPneQYwUL1VTX"
            "ngrok-skip-browser-warning" = "69420"
          }
          $runScheduleId = "d41f169d-88d5-442e-b8ba-9afe9dc01c3a"
          $url = "https://fba4-202-173-125-59.ngrok-free.app/api/v3/schedules/$runScheduleId/runNow?TEST_VALUE='ABC'"
          $response = Invoke-WebRequest -Uri $url -Method PUT -ContentType "application/json" -Headers $headers

          if ($response.StatusCode -eq 200) {
            $responseData = $response.Content | ConvertFrom-Json
            Write-Output "Response JSON: $($responseData | ConvertTo-Json -Depth 100)"
            # Process $responseData here
          } else {
            Write-Output "HTTP Error $($response.StatusCode) - $($response.StatusDescription)"
            Write-Output "Response Content:"
            Write-Output $response.Content
            # Handle error or unexpected response here
          }
